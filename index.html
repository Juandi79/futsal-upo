
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Futsal UPO 25/26</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #e6f2e6;
      margin: 20px;
    }
    h1, h2 {
      text-align: center;
      color: #006600;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #009933;
      color: white;
    }
    input[type="number"] {
      width: 50px;
    }
    button {
      padding: 5px 10px;
      background-color: #009933;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #007a29;
    }
  </style>
</head>
<body>
  <h1>Futsal UPO 25/26</h1>
  <h2>Calendario de Partidos</h2>
  <table id="calendar">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Equipo 1</th>
        <th>Goles</th>
        <th>Equipo 2</th>
        <th>Goles</th>
        <th>Guardar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h2>Clasificaci√≥n</h2>
  <table id="standings">
    <thead>
      <tr>
        <th>Equipo</th>
        <th>PG</th>
        <th>PE</th>
        <th>PP</th>
        <th>GF</th>
        <th>GC</th>
        <th>DG</th>
        <th>Puntos</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, set, get, child, onValue } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDfzRPne1XCfwwU8L674yt69A4VhsTImsg",
      authDomain: "futsal-upo-25-26.firebaseapp.com",
      databaseURL: "https://futsal-upo-25-26-default-rtdb.firebaseio.com",
      projectId: "futsal-upo-25-26",
      storageBucket: "futsal-upo-25-26.firebasestorage.app",
      messagingSenderId: "137379254295",
      appId: "1:137379254295:web:2b5968064ca66d08530c52"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const calendarBody = document.querySelector("#calendar tbody");
    const standingsBody = document.querySelector("#standings tbody");

    const teams = ["Blancos", "Oscuros"];
    const matches = [];

    function generateMondays(start, end) {
      const dates = [];
      let current = new Date(start);
      while (current <= end) {
        if (current.getDay() === 1) {
          dates.push(new Date(current));
        }
        current.setDate(current.getDate() + 1);
      }
      return dates;
    }

    const matchDates = generateMondays(new Date("2025-09-01"), new Date("2026-06-29"));
    matchDates.forEach(date => {
      const dateStr = date.toISOString().split("T")[0];
      matches.push({ date: dateStr, team1: "Blancos", team2: "Oscuros" });
    });

    function renderCalendar() {
      calendarBody.innerHTML = "";
      matches.forEach(match => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${match.date}</td>
          <td>${match.team1}</td>
          <td><input type="number" min="0" id="g1-${match.date}"></td>
          <td>${match.team2}</td>
          <td><input type="number" min="0" id="g2-${match.date}"></td>
          <td><button onclick="saveResult('${match.date}')">Guardar</button></td>
        `;
        calendarBody.appendChild(row);
      });
    }

    window.saveResult = function(date) {
      const goals1 = parseInt(document.getElementById(`g1-${date}`).value) || 0;
      const goals2 = parseInt(document.getElementById(`g2-${date}`).value) || 0;
      set(ref(db, "matches/" + date), {
        team1: "Blancos",
        goals1: goals1,
        team2: "Oscuros",
        goals2: goals2
      });
    };

    function loadResults() {
      onValue(ref(db, "matches"), snapshot => {
        const data = snapshot.val();
        if (!data) return;
        const stats = {
          Blancos: { PG: 0, PE: 0, PP: 0, GF: 0, GC: 0 },
          Oscuros: { PG: 0, PE: 0, PP: 0, GF: 0, GC: 0 }
        };

        for (const date in data) {
          const match = data[date];
          const g1 = match.goals1;
          const g2 = match.goals2;
          document.getElementById(`g1-${date}`).value = g1;
          document.getElementById(`g2-${date}`).value = g2;

          stats[match.team1].GF += g1;
          stats[match.team1].GC += g2;
          stats[match.team2].GF += g2;
          stats[match.team2].GC += g1;

          if (g1 > g2) {
            stats[match.team1].PG++;
            stats[match.team2].PP++;
          } else if (g1 < g2) {
            stats[match.team2].PG++;
            stats[match.team1].PP++;
          } else {
            stats[match.team1].PE++;
            stats[match.team2].PE++;
          }
        }

        const standings = teams.map(team => {
          const s = stats[team];
          const DG = s.GF - s.GC;
          const Pts = s.PG * 3 + s.PE;
          return { team, ...s, DG, Pts };
        });

        standings.sort((a, b) => b.Pts - a.Pts || b.DG - a.DG || b.GF - a.GF);

        standingsBody.innerHTML = "";
        standings.forEach(s => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${s.team}</td>
            <td>${s.PG}</td>
            <td>${s.PE}</td>
            <td>${s.PP}</td>
            <td>${s.GF}</td>
            <td>${s.GC}</td>
            <td>${s.DG}</td>
            <td>${s.Pts}</td>
          `;
          standingsBody.appendChild(row);
        });
      });
    }

    renderCalendar();
    loadResults();
  </script>
</body>
</html>
